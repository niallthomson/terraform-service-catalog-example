# Terraform Cloud Service Broker - Sample Catalog

This repository is a sample catalog of services that can be exposed by the [Terraform Cloud Service Broker](https://github.com/niallthomson/terraform-cloud-service-broker).

There are several considerations for how this repository is structured, and the content of the services:
- For portability reasons, the services provisioned tend to be accessible over the public Internet.
- To improve the readability the number of configuration options exposed have been kept to a minimum. However, these can be expanded to be more tunable.
- Where possible outputs are formatted such that they can be consumed by Spring Cloud Connectors for easy integration with Spring Boot.
- There is an assumption that credentials will be provided to Terraform using environment variables, which can be observed in `catalog.yml`.
- IP addresses tend to be used instead of DNS entries to simplify configuration
- Kubernetes services are deployed on new clusters, rather than re-using existing clusters

Many of these assumptions would not be true for more realistic, "production-grade" configurations, and it is possible to create significantely more 
complex Terraform configuration modules.

## Modules

Each top level directory represents a single Terraform 'module'. The `catalog.yml` file is then used to expose out these modules as distinct
service definitions.

| Module | Purpose |
|------------------|-----------------------------------------------------------------------------------------------------------------|
| `aws-rds-postgres` | AWS RDS Postgres database in the default VPC that is publicly accessible. |
| `aws-s3-bucket` | AWS S3 bucket with IAM access/secret key pair for each application that binds. |
| `gcp-sql-postgres` | Google Cloud Platform SQLCloud Postgres database that is publicly accessible. |
| `gke-rabbitmq`     | RabbitMQ running on Google Kubernetes Engine, installed with a helm chart |
| `vault-kv` | Key/Value backend in an existing Hashicorp Vault server, along with an appropriately scoped token. |
| `vault-cf-auth` | Example of provisoning Vault infrastructure to leverage the Cloud Foundry auth method. |
| `random-id` | Returns a random ID generated by Terraform, used for quick test scenarios without creating actual infrastructure. |